# Calendar Shift Management: Add Template → Save
# Tests the calendar shift creation workflow
#
# Accessibility status after fixes:
# ✅ Main screens: Full ID/label support (kAXErrorInvalidUIElement FIXED)
# ✅ FAB button: Works by ID (accessible={false} on container)
# ✅ Nav buttons: Works by ID (accessible={false} on container)
# ✅ Template panel: template-add works by ID
# ⚠️ Edit form: Coordinates needed (complex nested form accessibility issue)
appId: com.openworkinghours.mobileapp

---

# Start fresh - launch the app
- launchApp:
    clearState: false

# Dismiss any dialogs
- tapOn:
    text: "OK"
    optional: true
- tapOn:
    text: "Abbrechen"
    optional: true

# Navigate to Calendar tab
- tapOn:
    text: "Kalender.*"
- takeScreenshot: "01_calendar_view"

# Test navigation buttons by ID
- tapOn:
    id: "calendar-prev"
- tapOn:
    id: "calendar-next"

# Open FAB menu by ID
- tapOn:
    id: "calendar-fab"

# Wait for FAB menu
- extendedWaitUntil:
    visible:
      text: "Dienste"
    timeout: 3000
- takeScreenshot: "02_fab_menu_open"

# Select "Dienste" (Shifts)
- tapOn:
    text: "Dienste"

# Wait for template panel
- extendedWaitUntil:
    visible:
      id: "template-add"
    timeout: 3000
- takeScreenshot: "03_template_panel_open"

# Tap "+ Neu" button by ID
- tapOn:
    id: "template-add"

# Wait for edit form
- swipe:
    start: "50%, 50%"
    end: "50%, 50%"
    duration: 600
- takeScreenshot: "04_template_editing"

# Save template (coordinates - edit form accessibility issue)
- tapOn:
    point: "25%,87%"

# Wait for save
- swipe:
    start: "50%, 50%"
    end: "50%, 50%"
    duration: 800
- takeScreenshot: "05_template_saved"

# Close panel
- tapOn:
    point: "50%, 30%"

# Verify FAB is back by ID
- extendedWaitUntil:
    visible:
      id: "calendar-fab"
    timeout: 3000
- takeScreenshot: "06_flow_complete"
